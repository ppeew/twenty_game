# 后台管理服务

说明：
- admin服务具备操作其他服务内部文件权限
- admin也作为微服务部署到各个主机上

功能：
- 日志收集(改为各服务自身负责)
  - 当前多个微服务部署在同一机子上，日志文件名都相同，有写入混乱问题。
    - 日志按主机，服务，日期区分，因此日志名为 主机名+日期+服务名+随机数
    - 同一主机同一服务名通过随机数区分
  - 服务长时间在同一日志文件中积累日志信息，且未作备份，有冗长和丢失风险问题。
    - 需要按日期分割，每个服务每天会创建新的日志来写入
    - 做好备份，晚上12：00触发admin服务监控，将本机所有服务当天日志发送到mongodb储存
  - 每天产生本地日志过多导致的积压问题
    - 各个admin服务在确保mongodb中存在日志后，删除超过一周时间的本地日志
- 信息展示(暂缓)
  - 每个admin服务收集本地主机名，cpu，内存，其他服务访问端口之类信息
    - 每隔半小时（默认，也可前台设置）收集一次，只储存当天情况
  - 展示日志
- 监控告警
  - 实时监听consul中各服务情况
    - 一旦有服务挂了，本机admin服务短信或邮箱通知相关人员
    - 服务挂了原因
      - 服务本身bug
      - 流量过大而宕机
      - 主机宕机
      - 以上原因都不应自动重启服务，而是手动排查修改错误，手动重启
    - 具体admin间如何协作，仿照redis的哨兵集群实现？（难点，取消）
  - 每十五分钟检测主机cpu,内存情况，超过阈值告警